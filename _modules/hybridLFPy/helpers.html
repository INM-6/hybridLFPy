<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hybridLFPy.helpers &mdash; hybridLFPy 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="hybridLFPy 0.1.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">hybridLFPy 0.1.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hybridLFPy.helpers</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Documentation:</span>

<span class="sd">This is a script containing general helper functions which can be applied</span>
<span class="sd">to specialized cases.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">ss</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>


<span class="c">###################################</span>
<span class="c"># Initialization of MPI stuff     #</span>
<span class="c">###################################</span>
<span class="n">COMM</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="n">SIZE</span> <span class="o">=</span> <span class="n">COMM</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="n">RANK</span> <span class="o">=</span> <span class="n">COMM</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>



<span class="c">#######################################</span>
<span class="c">### DATA I/O                        ###</span>
<span class="c">#######################################</span>


<div class="viewcode-block" id="read_gdf"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.read_gdf">[docs]</a><span class="k">def</span> <span class="nf">read_gdf</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast line-by-line gdf-file reader.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str </span>
<span class="sd">        Path to gdf-file.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        ([gid, val0, val1, **]), dtype=object) mixed datatype array</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">gdf_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">gdf_file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">gdf</span> <span class="o">+=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gdf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">gdf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="write_gdf"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.write_gdf">[docs]</a><span class="k">def</span> <span class="nf">write_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast line-by-line gdf-file write function</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : numpy.ndarray</span>
<span class="sd">        Column 0 is gids, columns 1: are values.</span>
<span class="sd">    fname : str</span>
<span class="sd">        Path to gdf-file.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gdf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
            <span class="n">gdf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">gdf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="load_h5_data"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.load_h5_data">[docs]</a><span class="k">def</span> <span class="nf">load_h5_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s">&#39;LFP&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">electrode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">warmup</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function loading results from hdf5 file</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path to hdf5-file</span>
<span class="sd">    data_type : str</span>
<span class="sd">        Signal types in [&#39;CSD&#39; , &#39;LFP&#39;, &#39;CSDsum&#39;, &#39;LFPsum&#39;].</span>
<span class="sd">    y : None or str</span>
<span class="sd">        Name of population.</span>
<span class="sd">    electrode : None or int</span>
<span class="sd">        TODO: update, electrode is NOT USED</span>
<span class="sd">    warmup : float</span>
<span class="sd">        Lower cutoff of time series to remove possible transients</span>
<span class="sd">    scaling : float,</span>
<span class="sd">        Scaling factor for population size that determines the amount of loaded</span>
<span class="sd">        single-cell signals</span>
<span class="sd">                </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        [electrode id, compound signal] if `y` is None</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        [cell id, electrode, single-cell signal] otherwise</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">electrode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">s.h5&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">data_type</span><span class="p">)))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[:,:,</span> <span class="n">warmup</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">scaling</span> <span class="o">!=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">num_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="n">scaling</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">num_cells</span><span class="p">,:,</span> <span class="n">warmup</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">sum.h5&#39;</span> <span class="o">%</span><span class="n">data_type</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[:,</span> <span class="n">warmup</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">data</span>

</div>
<div class="viewcode-block" id="dump_dict_of_nested_lists_to_h5"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.dump_dict_of_nested_lists_to_h5">[docs]</a><span class="k">def</span> <span class="nf">dump_dict_of_nested_lists_to_h5</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take nested list structure and dump it in hdf5 file.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str </span>
<span class="sd">        Filename</span>
<span class="sd">    data : dict(list(numpy.ndarray))</span>
<span class="sd">        Dict of nested lists with variable len arrays.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Open file</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;writing to file: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c"># Iterate over values</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ivalue</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">igrp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">jvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ivalue</span><span class="p">):</span>
            <span class="n">jgrp</span> <span class="o">=</span> <span class="n">igrp</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">kvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jvalue</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kvalue</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">jgrp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">kvalue</span><span class="p">,</span>
                                               <span class="n">compression</span><span class="o">=</span><span class="s">&#39;gzip&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">jgrp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">kvalue</span><span class="p">,</span>
                                               <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">),</span>
                                               <span class="n">compression</span><span class="o">=</span><span class="s">&#39;gzip&#39;</span><span class="p">)</span>
    <span class="c"># Close file</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="load_dict_of_nested_lists_from_h5"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.load_dict_of_nested_lists_from_h5">[docs]</a><span class="k">def</span> <span class="nf">load_dict_of_nested_lists_from_h5</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">toplevelkeys</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load nested list structure from hdf5 file</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------        </span>
<span class="sd">    fname : str</span>
<span class="sd">        Filename</span>
<span class="sd">    toplevelkeys : None or iterable, </span>
<span class="sd">        Load a two(default) or three-layered structure.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict(list(numpy.ndarray))</span>
<span class="sd">        dictionary of nested lists with variable length array data.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># Container:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Open file object</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="c"># Iterate over partial dataset</span>
    <span class="k">if</span> <span class="n">toplevelkeys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">toplevelkeys</span><span class="p">:</span>
            <span class="n">ivalue</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">jvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ivalue</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">kvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jvalue</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kvalue</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ivalue</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">jvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ivalue</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">kvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jvalue</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kvalue</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c"># Close dataset</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">data</span>

</div>
<div class="viewcode-block" id="setup_file_dest"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.setup_file_dest">[docs]</a><span class="k">def</span> <span class="nf">setup_file_dest</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">clearDestination</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to set up the file catalog structure for simulation output</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------  </span>
<span class="sd">    params : object </span>
<span class="sd">        e.g., `cellsim16popsParams.multicompartment_params()`</span>
<span class="sd">    clear_dest : bool </span>
<span class="sd">        Savefolder will be cleared if already existing.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">RANK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clearDestination</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;removing folder tree </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;find </span><span class="si">%s</span><span class="s"> -delete&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">)</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">savefolder</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cells_path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">cells_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cells_path</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">figures_path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">figures_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">figures_path</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">populations_path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">populations_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">populations_path</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">raw_nest_output_path</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">raw_nest_output_path</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">raw_nest_output_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">spike_output_path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;creating </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">spike_output_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">spike_output_path</span><span class="p">)</span>
    
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;cellsim16popsParams.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;cellsim16pops.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;example_brunel.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;brunel_alpha_nest.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;mesocircuit.sli&#39;</span><span class="p">,</span>
                  <span class="s">&#39;mesocircuit_LFP_model.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;binzegger_connectivity_table.json&#39;</span><span class="p">,</span> 
                  <span class="s">&#39;nest_simulation.py&#39;</span><span class="p">,</span>
                  <span class="s">&#39;microcircuit.sli&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">sim_scripts_path</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
                             <span class="n">stat</span><span class="o">.</span><span class="n">S_IREAD</span><span class="p">)</span>
       
    <span class="n">COMM</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
    

<span class="c">#######################################</span>
<span class="c">### GENERAL                         ###</span>
<span class="c">#######################################</span>

</div>
<div class="viewcode-block" id="calculate_fft"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.calculate_fft">[docs]</a><span class="k">def</span> <span class="nf">calculate_fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the Fourier transform of data.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1D or 2D array containing time series.</span>
<span class="sd">    tbin : float</span>
<span class="sd">        Bin size of time series (in ms).</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freqs : numpy.ndarray</span>
<span class="sd">        Frequency axis of signal in Fourier space.         </span>
<span class="sd">    fft : numpy.ndarray</span>
<span class="sd">        Signal in Fourier space.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tbin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tbin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c">#######################################</span>
<span class="c">### DATA MANIPULATION               ###</span>
<span class="c">#######################################</span>
</div>
<div class="viewcode-block" id="centralize"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.centralize">[docs]</a><span class="k">def</span> <span class="nf">centralize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to subtract the mean across time and/or across units from data</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------  </span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1D or 2D array containing time series, 1st index: unit, 2nd index: time</span>
<span class="sd">    time : bool</span>
<span class="sd">        True: subtract mean across time.</span>
<span class="sd">    units : bool</span>
<span class="sd">        True: subtract mean across units.</span>
<span class="sd">            </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        1D or 0D array of centralized signal.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">res</span>

</div>
<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to normalize data to have mean 0 and unity standard deviation</span>
<span class="sd">    (also called z-transform)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        z-transform of input array</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">-=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">data</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>


<span class="c">#######################################</span>
<span class="c">### FILTER                          ###</span>
<span class="c">#######################################</span>
</div>
<div class="viewcode-block" id="movav"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.movav">[docs]</a><span class="k">def</span> <span class="nf">movav</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Moving average rectangular window filter:</span>
<span class="sd">    calculate average of signal y by using sliding rectangular</span>
<span class="sd">    window of size Dx using binsize dx</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : numpy.ndarray</span>
<span class="sd">        Signal</span>
<span class="sd">    Dx : float</span>
<span class="sd">        Window length of filter.</span>
<span class="sd">    dx : float</span>
<span class="sd">        Bin size of signal sampling.</span>
<span class="sd">                </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Filtered signal.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Dx</span> <span class="o">&lt;=</span> <span class="n">dx</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ly</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ly</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">Dx</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)))</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)::]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Y</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yf</span>

</div>
<div class="viewcode-block" id="decimate"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.decimate">[docs]</a><span class="k">def</span> <span class="nf">decimate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">filterfun</span><span class="o">=</span><span class="n">ss</span><span class="o">.</span><span class="n">cheby1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    scipy.signal.decimate like downsampling using filtfilt instead of lfilter,</span>
<span class="sd">    and filter coeffs from butterworth or chebyshev type 1.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : numpy.ndarray</span>
<span class="sd">        Array to be downsampled along last axis.</span>
<span class="sd">    q : int </span>
<span class="sd">        Downsampling factor.</span>
<span class="sd">    n : int</span>
<span class="sd">        Butterworth filter order.</span>
<span class="sd">    k : float</span>
<span class="sd">        Aliasing filter critical frequency will be set as Wn=k/q.</span>
<span class="sd">    filterfun : function</span>
<span class="sd">        `scipy.signal.filter_design.cheby1` or</span>
<span class="sd">        `scipy.signal.filter_design.butter` function</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Array of downsampled signal.</span>
<span class="sd">              </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;q must be an integer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">filterfun</span> <span class="o">==</span> <span class="n">ss</span><span class="o">.</span><span class="n">butter</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">filterfun</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filterfun</span> <span class="o">==</span> <span class="n">ss</span><span class="o">.</span><span class="n">cheby1</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">filterfun</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">k</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;only ss.butter or ss.cheby1 supported&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="c"># Multidim array can only be processed at once for scipy &gt;= 0.9.0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">[:,</span> <span class="p">::</span><span class="n">q</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">[::</span><span class="n">q</span><span class="p">]</span>


<span class="c">#######################################</span>
<span class="c">### CORRELATION ANALYSIS            ###</span>
<span class="c">#######################################</span>

</div>
<div class="viewcode-block" id="mean"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.mean">[docs]</a><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to compute mean of data</span>


<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1st axis unit, 2nd axis time</span>
<span class="sd">    units : bool</span>
<span class="sd">        Average over units</span>
<span class="sd">    time : bool </span>
<span class="sd">        Average over time</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    if units=False and time=False: </span>
<span class="sd">        error</span>
<span class="sd">    if units=True: </span>
<span class="sd">        1 dim numpy.ndarray; time series</span>
<span class="sd">    if time=True: </span>
<span class="sd">        1 dim numpy.ndarray; series of unit means across time</span>
<span class="sd">    if units=True and time=True: </span>
<span class="sd">        float; unit and time mean</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; mean(np.array([[1, 2, 3], [4, 5, 6]]), units=True)</span>
<span class="sd">    array([ 2.5,  3.5,  4.5])</span>

<span class="sd">    &gt;&gt;&gt; mean(np.array([[1, 2, 3], [4, 5, 6]]), time=True)</span>
<span class="sd">    array([ 2.,  5.])</span>

<span class="sd">    &gt;&gt;&gt; mean(np.array([[1, 2, 3], [4, 5, 6]]), units=True,time=True)</span>
<span class="sd">    3.5</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span><span class="p">(</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="compound_mean"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.compound_mean">[docs]</a><span class="k">def</span> <span class="nf">compound_mean</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the mean of the compound/sum signal.</span>
<span class="sd">    Data is first summed across units and averaged across time.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1st axis unit, 2nd axis time</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        time-averaged compound/sum signal</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; compound_mean(np.array([[1, 2, 3], [4, 5, 6]]))</span>
<span class="sd">    7.0</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="variance"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.variance">[docs]</a><span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the variance of data across time, units or both.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    data : numpy.ndarray </span>
<span class="sd">        1st axis unit, 2nd axis time.</span>
<span class="sd">    units : bool </span>
<span class="sd">        Variance across units</span>
<span class="sd">    time : bool</span>
<span class="sd">        Average over time</span>


<span class="sd">    Returns</span>
<span class="sd">    ---------- </span>
<span class="sd">    if units=False and time=False: </span>
<span class="sd">        Exception</span>
<span class="sd">    if units=True: </span>
<span class="sd">        1 dim numpy.ndarray; time series     </span>
<span class="sd">    if time=True:  </span>
<span class="sd">        1 dim numpy.ndarray; series of single unit variances across time</span>
<span class="sd">    if units=True and time=True: </span>
<span class="sd">        float; mean of single unit variances across time</span>


<span class="sd">    Examples</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt;&gt;&gt; variance(np.array([[1, 2, 3],[4, 5, 6]]), units=True)</span>
<span class="sd">    array([ 2.25,  2.25,  2.25])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; variance(np.array([[1, 2, 3], [4, 5, 6]]), time=True)</span>
<span class="sd">    array([ 0.66666667,  0.66666667])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; variance(np.array([[1, 2, 3], [4, 5, 6]]), units=True, time=True)</span>
<span class="sd">    0.66666666666666663</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span><span class="p">(</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="compound_variance"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.compound_variance">[docs]</a><span class="k">def</span> <span class="nf">compound_variance</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the variance of the compound/sum signal.</span>
<span class="sd">    Data is first summed across units, then the variance across time</span>
<span class="sd">    is calculated.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1st axis unit, 2nd axis time</span>
<span class="sd">  </span>

<span class="sd">    Returns</span>
<span class="sd">    -------  </span>
<span class="sd">    float</span>
<span class="sd">        variance across time of compound/sum signal</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; compound_variance(np.array([[1, 2, 3], [4, 5, 6]]))</span>
<span class="sd">    2.6666666666666665</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="powerspec"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.powerspec">[docs]</a><span class="k">def</span> <span class="nf">powerspec</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pointProcess</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate (smoothed) power spectra of all timeseries in data.</span>
<span class="sd">    If units=True, power spectra are averaged across units.</span>
<span class="sd">    Note that averaging is done on power spectra rather than data.</span>

<span class="sd">    If pointProcess is True, power spectra are normalized by the length T of the</span>
<span class="sd">    time series.</span>

<span class="sd"> </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1st axis unit, 2nd axis time.</span>
<span class="sd">    tbin : float</span>
<span class="sd">        Binsize in ms.</span>
<span class="sd">    Df : float/None, </span>
<span class="sd">        Window width of sliding rectangular filter (smoothing),</span>
<span class="sd">        None is no smoothing.</span>
<span class="sd">    units : bool</span>
<span class="sd">        Average power spectrum.</span>
<span class="sd">    pointProcess : bool</span>
<span class="sd">        If set to True, powerspectrum is normalized to signal length T.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freq : tuple</span>
<span class="sd">        numpy.ndarray of frequencies.</span>
<span class="sd">    POW : tuple</span>
<span class="sd">        if units=False: </span>
<span class="sd">            2 dim numpy.ndarray; 1st axis unit, 2nd axis frequency</span>
<span class="sd">        if units=True:  </span>
<span class="sd">            1 dim numpy.ndarray; frequency series</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------    </span>
<span class="sd">    &gt;&gt;&gt; powerspec(np.array([analog_sig1, analog_sig2]), tbin, Df=Df)</span>
<span class="sd">    Out[1]: (freq,POW)</span>
<span class="sd">    &gt;&gt;&gt; POW.shape</span>
<span class="sd">    Out[2]: (2,len(analog_sig1))</span>

<span class="sd">    &gt;&gt;&gt; powerspec(np.array([analog_sig1, analog_sig2]), tbin, Df=Df, units=True)</span>
<span class="sd">    Out[1]: (freq,POW)</span>
<span class="sd">    &gt;&gt;&gt; POW.shape</span>
<span class="sd">    Out[2]: (len(analog_sig1),)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">freq</span><span class="p">,</span> <span class="n">DATA</span> <span class="o">=</span> <span class="n">calculate_fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">tbin</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">POW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">Df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">POW</span> <span class="o">=</span> <span class="p">[</span><span class="n">movav</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Df</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">POW</span><span class="p">]</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Df</span> <span class="o">/</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">cut</span><span class="p">:]</span>
        <span class="n">POW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">cut</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">POW</span><span class="p">])</span>
        <span class="n">POW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">POW</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">POW</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">POW</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">POW</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">POW</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">pointProcess</span><span class="p">:</span>
        <span class="n">POW</span> <span class="o">*=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c"># Normalization, power independent of T</span>
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">POW</span>

</div>
<div class="viewcode-block" id="compound_powerspec"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.compound_powerspec">[docs]</a><span class="k">def</span> <span class="nf">compound_powerspec</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pointProcess</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the power spectrum of the compound/sum signal.</span>
<span class="sd">    data is first summed across units, then the power spectrum is calculated.</span>

<span class="sd">    If pointProcess=True, power spectra are normalized by the length T of</span>
<span class="sd">    the time series.</span>

<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray, </span>
<span class="sd">        1st axis unit, 2nd axis time</span>
<span class="sd">    tbin : float, </span>
<span class="sd">        binsize in ms</span>
<span class="sd">    Df : float/None, </span>
<span class="sd">        window width of sliding rectangular filter (smoothing),</span>
<span class="sd">        None -&gt; no smoothing</span>
<span class="sd">    pointProcess : bool, </span>
<span class="sd">        if set to True, powerspectrum is normalized to signal length T</span>
<span class="sd">                 </span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freq : tuple</span>
<span class="sd">        numpy.ndarray of frequencies</span>
<span class="sd">    POW : tuple</span>
<span class="sd">        1 dim numpy.ndarray, frequency series</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; compound_powerspec(np.array([analog_sig1, analog_sig2]), tbin, Df=Df)</span>
<span class="sd">    Out[1]: (freq,POW)</span>
<span class="sd">    &gt;&gt;&gt; POW.shape</span>
<span class="sd">    Out[2]: (len(analog_sig1),)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">powerspec</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="n">Df</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">pointProcess</span><span class="o">=</span><span class="n">pointProcess</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="crossspec"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.crossspec">[docs]</a><span class="k">def</span> <span class="nf">crossspec</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pointProcess</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate (smoothed) cross spectra of data.</span>
<span class="sd">    If `units`=True, cross spectra are averaged across units.</span>
<span class="sd">    Note that averaging is done on cross spectra rather than data.</span>

<span class="sd">    Cross spectra are normalized by the length T of the time series -&gt; no</span>
<span class="sd">    scaling with T.</span>

<span class="sd">    If pointProcess=True, power spectra are normalized by the length T of the</span>
<span class="sd">    time series.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray, </span>
<span class="sd">        1st axis unit, 2nd axis time</span>
<span class="sd">    tbin : float, </span>
<span class="sd">        binsize in ms</span>
<span class="sd">    Df : float/None, </span>
<span class="sd">        window width of sliding rectangular filter (smoothing),</span>
<span class="sd">        None -&gt; no smoothing</span>
<span class="sd">    units : bool, </span>
<span class="sd">        average cross spectrum</span>
<span class="sd">    pointProcess : bool, </span>
<span class="sd">        if set to True, cross spectrum is normalized to signal length T</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freq : tuple</span>
<span class="sd">        numpy.ndarray of frequencies</span>
<span class="sd">    CRO : tuple</span>
<span class="sd">        if `units`=True: 1 dim numpy.ndarray; frequency series</span>
<span class="sd">        if `units`=False:3 dim numpy.ndarray; 1st axis first unit,</span>
<span class="sd">            2nd axis second unit, 3rd axis frequency</span>


<span class="sd">    Examples</span>
<span class="sd">    --------    </span>
<span class="sd">    &gt;&gt;&gt; crossspec(np.array([analog_sig1, analog_sig2]), tbin, Df=Df)</span>
<span class="sd">    Out[1]: (freq,CRO)</span>
<span class="sd">    &gt;&gt;&gt; CRO.shape</span>
<span class="sd">    Out[2]: (2,2,len(analog_sig1))</span>

<span class="sd">    &gt;&gt;&gt; crossspec(np.array([analog_sig1, analog_sig2]), tbin, Df=Df, units=True)</span>
<span class="sd">    Out[1]: (freq,CRO)</span>
<span class="sd">    &gt;&gt;&gt; CRO.shape</span>
<span class="sd">    Out[2]: (len(analog_sig1),)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c"># smoothing and normalization take place in powerspec</span>
        <span class="c"># and compound_powerspec</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">POW</span> <span class="o">=</span> <span class="n">powerspec</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="n">Df</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">freq_com</span><span class="p">,</span> <span class="n">CPOW</span> <span class="o">=</span> <span class="n">compound_powerspec</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="n">Df</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_com</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">freq_com</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq_com</span><span class="p">))</span>
        <span class="n">CRO</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">CPOW</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">POW</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">CRO</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">DATA</span> <span class="o">=</span> <span class="n">calculate_fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">tbin</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Df</span> <span class="o">/</span> <span class="n">df</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">cut</span><span class="p">:]</span>
        <span class="n">CRO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tempij</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">DATA</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">tempij</span> <span class="o">=</span> <span class="n">movav</span><span class="p">(</span><span class="n">tempij</span><span class="p">,</span> <span class="n">Df</span><span class="p">,</span> <span class="n">df</span><span class="p">)[</span><span class="n">cut</span><span class="p">:]</span>
                <span class="n">CRO</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempij</span>
                <span class="n">CRO</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CRO</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">CRO</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">pointProcess</span><span class="p">:</span>
            <span class="n">CRO</span> <span class="o">*=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c"># normalization</span>
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">CRO</span>

</div>
<div class="viewcode-block" id="compound_crossspec"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.compound_crossspec">[docs]</a><span class="k">def</span> <span class="nf">compound_crossspec</span><span class="p">(</span><span class="n">a_data</span><span class="p">,</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pointProcess</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate cross spectra of compound signals.</span>
<span class="sd">    a_data is a list of datasets (a_data = [data1,data2,...]).</span>
<span class="sd">    For each dataset in a_data, the compound signal is calculated</span>
<span class="sd">    and the crossspectra between these compound signals is computed.</span>
<span class="sd">    </span>
<span class="sd">    If pointProcess=True, power spectra are normalized by the length T of the</span>
<span class="sd">    time series.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a_data : list of numpy.ndarrays</span>
<span class="sd">        Array: 1st axis unit, 2nd axis time.     </span>
<span class="sd">    tbin : float</span>
<span class="sd">        Binsize in ms.</span>
<span class="sd">    Df : float/None, </span>
<span class="sd">        Window width of sliding rectangular filter (smoothing),</span>
<span class="sd">        None -&gt; no smoothing.</span>
<span class="sd">    pointProcess : bool</span>
<span class="sd">        If set to True, crossspectrum is normalized to signal length `T`</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freq : tuple</span>
<span class="sd">        numpy.ndarray of frequencies.</span>
<span class="sd">    CRO : tuple</span>
<span class="sd">        3 dim numpy.ndarray; 1st axis first compound signal, 2nd axis second</span>
<span class="sd">        compound signal, 3rd axis frequency.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; compound_crossspec([np.array([analog_sig1, analog_sig2]),</span>
<span class="sd">                            np.array([analog_sig3,analog_sig4])], tbin, Df=Df)</span>
<span class="sd">    Out[1]: (freq,CRO)</span>
<span class="sd">    &gt;&gt;&gt; CRO.shape</span>
<span class="sd">    Out[2]: (2,2,len(analog_sig1))</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a_mdata</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">a_data</span><span class="p">:</span>
        <span class="n">a_mdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  <span class="c"># calculate compound signals</span>
    <span class="k">return</span> <span class="n">crossspec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a_mdata</span><span class="p">),</span> <span class="n">tbin</span><span class="p">,</span> <span class="n">Df</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="n">pointProcess</span><span class="o">=</span><span class="n">pointProcess</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="autocorrfunc"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.autocorrfunc">[docs]</a><span class="k">def</span> <span class="nf">autocorrfunc</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate autocorrelation function(s) for given power spectrum/spectra.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freq : numpy.ndarray</span>
<span class="sd">        1 dimensional array of frequencies.</span>
<span class="sd">    power : numpy.ndarray</span>
<span class="sd">        2 dimensional power spectra, 1st axis units, 2nd axis frequencies.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    time : tuple</span>
<span class="sd">        1 dim numpy.ndarray of times.</span>
<span class="sd">    autof : tuple</span>
<span class="sd">        2 dim numpy.ndarray; autocorrelation functions, 1st axis units,</span>
<span class="sd">        2nd axis times.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tbin</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c"># tbin in ms</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tbin</span>
    <span class="c"># T = max(time)</span>
    <span class="n">multidata</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">power</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">multidata</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">multidata</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
        <span class="n">autof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">raw_autof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_autof</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">autof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">raw_autof</span><span class="p">[</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">raw_autof</span><span class="p">[:</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">autof</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_autof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_autof</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">autof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">raw_autof</span><span class="p">[</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">raw_autof</span><span class="p">[:</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">autof</span><span class="p">))</span>
    <span class="c"># autof *= T*1e-3 # normalization is done in powerspec()</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">autof</span>

</div>
<div class="viewcode-block" id="crosscorrfunc"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.crosscorrfunc">[docs]</a><span class="k">def</span> <span class="nf">crosscorrfunc</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">cross</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate crosscorrelation function(s) for given cross spectra.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freq : numpy.ndarray</span>
<span class="sd">        1 dimensional array of frequencies.</span>
<span class="sd">    cross : numpy.ndarray </span>
<span class="sd">        2 dimensional array of cross spectra, 1st axis units, 2nd axis units,</span>
<span class="sd">        3rd axis frequencies.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    time : tuple</span>
<span class="sd">        1 dim numpy.ndarray of times.</span>
<span class="sd">    crossf : tuple</span>
<span class="sd">        3 dim numpy.ndarray, crosscorrelation functions,</span>
<span class="sd">        1st axis first unit, 2nd axis second unit, 3rd axis times.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tbin</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c"># tbin in ms</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tbin</span>
    <span class="c"># T = max(time)</span>
    <span class="n">multidata</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c"># check whether cross contains many cross spectra</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cross</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">multidata</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">multidata</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cross</span><span class="p">)</span>
        <span class="n">crossf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">raw_crossf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">cross</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]))</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_crossf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
                <span class="n">crossf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">raw_crossf</span><span class="p">[</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">raw_crossf</span><span class="p">[:</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_crossf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">cross</span><span class="p">))</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_crossf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">crossf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">raw_crossf</span><span class="p">[</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">raw_crossf</span><span class="p">[:</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossf</span><span class="p">))</span>
    <span class="c"># crossf *= T*1e-3 # normalization happens in cross spectrum</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">crossf</span>

</div>
<div class="viewcode-block" id="corrcoef"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.corrcoef">[docs]</a><span class="k">def</span> <span class="nf">corrcoef</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">crossf</span><span class="p">,</span> <span class="n">integration_window</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the correlation coefficient for given auto- and crosscorrelation</span>
<span class="sd">    functions. Standard settings yield the zero lag correlation coefficient.</span>
<span class="sd">    Setting integration_window &gt; 0 yields the correlation coefficient of</span>
<span class="sd">    integrated auto- and crosscorrelation functions. The correlation coefficient</span>
<span class="sd">    between a zero signal with any other signal is defined as 0.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time : numpy.ndarray</span>
<span class="sd">        1 dim array of times corresponding to signal.</span>
<span class="sd">    crossf : numpy.ndarray </span>
<span class="sd">        Crosscorrelation functions, 1st axis first unit, 2nd axis second unit,</span>
<span class="sd">        3rd axis times.</span>
<span class="sd">    integration_window: float</span>
<span class="sd">        Size of the integration window.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cc : numpy.ndarray</span>
<span class="sd">        2 dim array of correlation coefficient between two units.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossf</span><span class="p">)</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">crossf</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">tbin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">integration_window</span> <span class="o">/</span> <span class="n">tbin</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="n">mid</span> <span class="o">-</span> <span class="n">lim</span><span class="p">:</span><span class="n">mid</span> <span class="o">+</span> <span class="n">lim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">offset_autoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">][:</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">cij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">][</span><span class="n">mid</span> <span class="o">-</span> <span class="n">lim</span><span class="p">:</span><span class="n">mid</span> <span class="o">+</span> <span class="n">lim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">offset_cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">][:</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">aj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">][</span><span class="n">mid</span> <span class="o">-</span> <span class="n">lim</span><span class="p">:</span><span class="n">mid</span> <span class="o">+</span> <span class="n">lim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">offset_autoj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crossf</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">][:</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ai</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">aj</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">cc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cij</span><span class="o">-</span><span class="n">offset_cross</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">ai</span><span class="o">-</span><span class="n">offset_autoi</span><span class="p">)</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">aj</span><span class="o">-</span><span class="n">offset_autoj</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    
    <span class="k">return</span> <span class="n">cc</span>

</div>
<div class="viewcode-block" id="coherence"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.coherence">[docs]</a><span class="k">def</span> <span class="nf">coherence</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">cross</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate frequency resolved coherence for given power- and crossspectra.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freq : numpy.ndarray</span>
<span class="sd">        Frequencies, 1 dim array.</span>
<span class="sd">    power : numpy.ndarray</span>
<span class="sd">        Power spectra, 1st axis units, 2nd axis frequencies.</span>
<span class="sd">    cross : numpy.ndarray, </span>
<span class="sd">        Cross spectra, 1st axis units, 2nd axis units, 3rd axis frequencies.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freq: tuple</span>
<span class="sd">        1 dim numpy.ndarray of frequencies.</span>
<span class="sd">    coh: tuple</span>
<span class="sd">        ndim 3 numpy.ndarray of coherences, 1st axis units, 2nd axis units,</span>
<span class="sd">        3rd axis frequencies.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
    <span class="n">coh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cross</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">coh</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cross</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">power</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">coh</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">coh</span>

</div>
<div class="viewcode-block" id="cv"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.cv">[docs]</a><span class="k">def</span> <span class="nf">cv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate coefficient of variation (cv) of data. Mean and standard deviation</span>
<span class="sd">    are computed across time.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        1st axis unit, 2nd axis time.</span>
<span class="sd">    units : bool</span>
<span class="sd">        Average `cv`.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        If units=False, series of unit `cv`s.</span>
<span class="sd">    float</span>
<span class="sd">        If units=True, mean `cv` across units.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; cv(np.array([[1, 2, 3, 4, 5, 6], [11, 2, 3, 3, 4, 5]]))</span>
<span class="sd">    array([ 0.48795004,  0.63887656])</span>

<span class="sd">    &gt;&gt;&gt; cv(np.array([[1, 2, 3, 4, 5, 6], [11, 2, 3, 3, 4, 5]]), units=True)</span>
<span class="sd">    0.56341330073710316</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">variance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span>
    
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cv</span>

</div>
<div class="viewcode-block" id="fano"><a class="viewcode-back" href="../../index.html#hybridLFPy.helpers.fano">[docs]</a><span class="k">def</span> <span class="nf">fano</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate fano factor (FF) of data. Mean and variance are computed across</span>
<span class="sd">    time.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------   </span>
<span class="sd">    data : numpy.ndarray </span>
<span class="sd">        1st axis unit, 2nd axis time.</span>
<span class="sd">    units : bool</span>
<span class="sd">        Average `FF`.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        If units=False, series of unit FFs.</span>
<span class="sd">    float</span>
<span class="sd">        If units=True, mean FF across units.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; fano(np.array([[1, 2, 3, 4, 5, 6], [11, 2, 3, 3, 4, 5]]))</span>
<span class="sd">    array([ 0.83333333,  1.9047619 ])</span>

<span class="sd">    &gt;&gt;&gt; fano(np.array([[1, 2, 3, 4, 5, 6], [11, 2, 3, 3, 4, 5]]), units=True)</span>
<span class="sd">    1.3690476190476191</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">variance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">var</span> <span class="o">/</span> <span class="n">mu</span>
    
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ff</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">hybridLFPy 0.1.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Espen Hagen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>